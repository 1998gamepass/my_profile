<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å½©è›‹å°éŠæˆ²ï½œä¸€ç›´é»å°±å°äº†</title>
  <meta name="description" content="å½©è›‹ï¼šå¾ä¸Šæ–¹æŒçºŒæ‰è½çš„ç‰©å“ï¼Œé»ä¸€ä¸‹å°±åŠ åˆ†ï¼Œæ²’æœ‰çµå±€ï¼Œç©åˆ°é–‹å¿ƒç‚ºæ­¢ã€‚" />
  <meta name="theme-color" content="#f6f9fe" />
  <style>
    :root{
      --bg:#f6f9fe;           /* æ·ºè—åº• */
      --card:#ffffff;         /* ç™½è‰²å¡ç‰‡ */
      --text:#0b0c0f;         /* ä¸»è¦æ–‡å­— */
      --muted:#667085;        /* æ¬¡è¦æ–‡å­— */
      --blue:#0ea5e9;         /* è—è‰²é»ç¶´ */
      --orange:#fb923c;       /* æ©˜è‰²é»ç¶´ */
      --border:rgba(0,0,0,.08);
      --shadow:0 10px 26px rgba(0,0,0,.08);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;color:var(--text);background:var(--bg);font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans",Arial}
    body{overscroll-behavior:none; touch-action:manipulation; user-select:none}

    /* é ‚éƒ¨è³‡è¨Šæ¢ */
    .hud{position:fixed;inset:12px 12px auto 12px;display:flex;gap:10px;align-items:center;z-index:50}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;border:1px solid var(--border);background:var(--card);box-shadow:var(--shadow);font-weight:700}
    .muted{color:var(--muted);font-weight:600}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:12px;border:1px solid var(--border);background:linear-gradient(180deg,rgba(14,165,233,.14),rgba(14,165,233,.08));box-shadow:var(--shadow);font-weight:700;color:#09344f}
    .btn.orange{background:linear-gradient(180deg,rgba(251,146,60,.16),rgba(251,146,60,.08));color:#5a2c00}

    /* éŠæˆ²å€åŸŸ */
    #game{position:relative;height:100vh;overflow:hidden}

    /* æ‰è½ç‰© */
    .drop{position:absolute;top:-80px;left:0;transform:translateX(-50%);font-size:42px;line-height:1;filter:drop-shadow(0 4px 10px rgba(0,0,0,.15));will-change:transform;user-select:none;cursor:pointer}
    .drop.fast{animation:fall var(--dur) linear both}
    .drop .label{position:absolute;left:50%;top:-18px;transform:translateX(-50%);font-size:12px;color:#fff;background:rgba(0,0,0,.35);padding:2px 6px;border-radius:999px}

    /* è¢«é»åˆ°çš„çˆ†è£‚æ•ˆæœ */
    .hit{animation:pop .22s ease-out both}

    /* æ¼‚æµ® +åˆ† æ•ˆæœ */
    .float{position:absolute;pointer-events:none;left:0;top:0;font-weight:800;color:#14532d;text-shadow:0 1px 0 #fff}
    .float.anim{animation:rise .6s ease-out both}

    /* å¼•å°é¢æ¿ */
    .intro{position:fixed;inset:0;display:grid;place-items:center;background:linear-gradient(180deg,rgba(255,255,255,.75),rgba(246,249,254,.95));backdrop-filter:blur(6px);z-index:60}
    .card{width:min(520px,92vw);padding:20px;border:1px solid var(--border);background:var(--card);border-radius:18px;box-shadow:var(--shadow);text-align:center}

    @keyframes fall{from{transform:translate(-50%,-80px)} to{transform:translate(-50%,105vh)}}
    @keyframes pop{0%{transform:translate(-50%,0) scale(1);filter:drop-shadow(0 4px 10px rgba(0,0,0,.15))}80%{transform:translate(-50%,-6px) scale(1.28)}100%{transform:translate(-50%,-8px) scale(0);opacity:0}}
    @keyframes rise{from{transform:translate(-50%,0);opacity:1} to{transform:translate(-50%,-28px);opacity:0}}

    /* RWD å¾®èª¿ */
    @media (max-width: 480px){
      .drop{font-size:38px}
      .btn{padding:8px 10px}
    }
        /* é»æ“Šå¾Œä¸€å®šä½¿ç”¨ pop å‹•ç•«ï¼ˆè“‹é .drop.fast çš„ fallï¼‰ */
    .drop.hit{ animation: pop .22s ease-out both !important; }

  </style>
</head>
<body>
  <div class="hud">
    <div class="pill" id="score">åˆ†æ•¸ï¼š<span>0</span></div>
    <div class="pill">æœ€é«˜ï¼š<span id="best">0</span></div>
    <button class="btn" id="pause">æš«åœ</button>
    <button class="btn orange" id="reset">é‡ç½®åˆ†æ•¸</button>
  </div>

  <main id="game" aria-label="é»æ“Šå°éŠæˆ²å€åŸŸ"></main>

  <div class="intro" id="intro">
    <div class="card">
      <h2 style="margin:6px 0 8px">ğŸ‰ å½©è›‹å°éŠæˆ²ï½œä¸€ç›´é»å°±å°äº†</h2>
      <p class="muted" style="margin:0 0 10px">ç‰©å“æœƒä¸åœå¾ä¸Šæ–¹æ‰è½ï¼Œé»ä¸€ä¸‹ +1ï½+5 åˆ†ã€‚æ²’æœ‰çµå±€ï¼Œç©åˆ°é–‹å¿ƒç‚ºæ­¢ã€‚</p>
      <div style="display:flex;gap:10px;justify-content:center;margin-top:10px">
        <button class="btn" id="start">é–‹å§‹éŠæˆ²</button>
        <button class="btn orange" id="mute">æ„Ÿè¬èª</button>
      </div>
      <p class="muted" style="font-size:12px;margin-top:10px">è²¼å¿ƒæç¤ºï¼šå¯ä»¥æŠŠé€™é åŠ å…¥ä¸»ç•«é¢ï¼Œéš¨æ™‚é–‹ç©ã€‚</p>
    </div>
  </div>

  <audio id="sfx" preload="auto">
    <source src="data:audio/mpeg;base64,//uQZAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQCA/////wAAAACQTEFNRTMuMTAwA8MAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" type="audio/mpeg"/>
  </audio>

  <script>
    // =====================
    // éŠæˆ²è¨­å®š
    // =====================
    const EMOJIS = [
      {ch:'ğŸ ', pts:2},
      {ch:'ğŸ”‘', pts:3},
      {ch:'ğŸ’', pts:5},
      {ch:'ğŸª™', pts:2},
      {ch:'ğŸ“¦', pts:1},
      {ch:'ğŸ§±', pts:1}
    ];
    const MIN_DUR = 2.3;   // æ‰è½æœ€çŸ­ç§’æ•¸
    const MAX_DUR = 9.0;   // æ‰è½æœ€é•·ç§’æ•¸
    const SPAWN_START = 900; // åˆå§‹ç”¢ç”Ÿé–“éš”(ms)
    const SPAWN_MIN = 300;   // æœ€å¿«é–“éš”(ms)
    const SPAWN_ACCEL = 0.98; // æ¯æ¬¡ç”Ÿæˆå¾Œä¹˜ä¸Šæ­¤ä¿‚æ•¸ â†’ æ¼¸å¿«
    const MAX_NODES = 36;    // è¢å¹•ä¸Šæœ€å¤šæ‰è½ç‰©ï¼Œé¿å…å¡é “

    // ç‹€æ…‹
    let score = 0;
    let best = parseInt(localStorage.getItem('eggBest')||'0',10);
    let playing = false, paused = false; 
    let spawnMs = SPAWN_START; 
    let spawnHandle = null;

    // å…ƒç´ 
    const $game = document.getElementById('game');
    const $score = document.querySelector('#score span');
    const $best  = document.getElementById('best');
    const $pause = document.getElementById('pause');
    const $reset = document.getElementById('reset');
    const $intro = document.getElementById('intro');
    const $start = document.getElementById('start');
    const $mute  = document.getElementById('mute');
    const $sfx   = document.getElementById('sfx');

    $best.textContent = best;

    // éŸ³æ•ˆæ§åˆ¶ï¼ˆé è¨­é–‹å•Ÿï¼‰
    let muted = false;
    $mute.addEventListener('click', ()=>{ muted = !muted; $mute.textContent = muted ? 'è¬è¬æ‚¨å°æ–¼æˆ‘çš„å¥½å¥‡è€Œé»é€²äº†é€™å€‹ç¶²ç«™!!!' : 'åªæœ‰é€™å€‹é ­åƒæ˜¯éŠæˆ²ï¼Œåœ¨å…¶ä»–åœ°æ–¹é»æ“Šé€£çµå§'; });

    // é–‹å§‹
    $start.addEventListener('click', startGame);

    // æš«åœ/æ¢å¾©
    $pause.addEventListener('click', ()=>{ togglePause(); });
    document.addEventListener('visibilitychange', ()=>{ if(document.hidden && playing){ setPause(true);} });

    // é‡ç½®åˆ†æ•¸
    $reset.addEventListener('click', ()=>{ score = 0; updateScore(); });

    function startGame(){
      if(playing) return;
      playing = true; paused = false; score = 0; spawnMs = SPAWN_START; updateScore();
      $intro.style.display = 'none';
      loopSpawn();
    }

    function togglePause(){ setPause(!paused); }
    function setPause(v){
      paused = v; $pause.textContent = paused ? 'ç¹¼çºŒ' : 'æš«åœ';
      if(paused){ clearTimeout(spawnHandle); [...document.querySelectorAll('.drop')].forEach(n=>n.style.animationPlayState='paused'); }
      else { [...document.querySelectorAll('.drop')].forEach(n=>n.style.animationPlayState='running'); loopSpawn(); }
    }

    function loopSpawn(){
      if(!playing || paused) return;
      if($game.childElementCount < MAX_NODES){ spawnOne(); }
      spawnMs = Math.max(SPAWN_MIN, spawnMs * SPAWN_ACCEL);
      spawnHandle = setTimeout(loopSpawn, spawnMs);
    }

    function spawnOne(){
      const {innerWidth:w} = window;
      const it = EMOJIS[Math.floor(Math.random()*EMOJIS.length)];
      const x = Math.random() * (w - 40) + 20; // é‚Šç·£ç•™ç™½
      const dur = (Math.random()*(MAX_DUR - MIN_DUR) + MIN_DUR).toFixed(2) + 's';

      const el = document.createElement('div');
      el.className = 'drop fast';
      el.style.left = x + 'px';
      el.style.setProperty('--dur', dur);
      el.setAttribute('role','button');
      el.setAttribute('aria-label','é»æ“ŠåŠ åˆ†');
      el.dataset.pts = it.pts;
      el.innerHTML = `<span class="emoji">${it.ch}</span>`;

      // é»æ“ŠåŠ åˆ†
      function onHit(ev){
        ev.preventDefault();
        hit(el, it.pts, ev.clientX, ev.clientY);
      }
      el.addEventListener('pointerdown', onHit, {passive:false});
      el.addEventListener('click', onHit, {passive:false}); // å‚™æ´ï¼šèˆŠæ©Ÿ/èˆŠç€è¦½å™¨


      // æ‰åˆ°åº•è‡ªå‹•æ¸…é™¤
      el.addEventListener('animationend', ()=> el.remove(), {once:true});

      $game.appendChild(el);
    }

    function hit(el, pts, cx, cy){
      if(!el || !el.isConnected) return;
      // éŸ³æ•ˆ & éœ‡å‹•
      if(!muted){ try{ $sfx.currentTime = 0; $sfx.play(); }catch(e){} }
      if(navigator.vibrate){ navigator.vibrate(8); }

      // +åˆ†é£„å­—
      const f = document.createElement('div');
      f.className = 'float anim';
      f.textContent = '+'+pts;
      f.style.left = cx + 'px';
      f.style.top  = (cy - 10) + 'px';
      document.body.appendChild(f);
      setTimeout(()=>f.remove(), 620);

      // åœæ‰åŸæœ¬çš„æ‰è½å‹•ç•«ï¼Œå¼·åˆ¶é‡å•Ÿæ–°å‹•ç•«
      el.classList.remove('fast');   // ç§»é™¤æœƒå¥—ç”¨ fall çš„ class
      el.style.animation = 'none';   // ç«‹å³æ¸…é™¤å‹•ç•«
      void el.offsetHeight;          // å¼·åˆ¶ reflowï¼Œç¢ºä¿ä¸‹ä¸€æ®µå‹•ç•«èƒ½å•Ÿå‹•
      el.classList.add('hit');       // å•Ÿå‹• pop å‹•ç•«

      // ä¿éšªï¼šå°±ç®— animationend æ²’è§¸ç™¼ï¼Œä¹Ÿåœ¨ 260ms å¾Œç§»é™¤
      setTimeout(() => { if (el.isConnected) el.remove(); }, 260);

      // åˆ†æ•¸ & æ•ˆæœ
      score += pts; updateScore();
      el.classList.add('hit');
      el.addEventListener('animationend', ()=> el.remove(), {once:true});
    }

    function updateScore(){
      $score.textContent = score;
      if(score > best){ best = score; localStorage.setItem('eggBest', String(best)); $best.textContent = best; }
    }
  </script>
</body>
</html>
